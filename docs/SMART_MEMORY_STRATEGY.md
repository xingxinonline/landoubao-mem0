# æ™ºèƒ½è®°å¿†ç®¡ç†ç­–ç•¥æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº†æ™ºèƒ½ç§äººåŠ©ç†çš„è®°å¿†ç®¡ç†ç­–ç•¥ï¼ŒåŒ…æ‹¬å­˜å‚¨ã€æ›´æ–°ã€æŸ¥è¯¢å’Œæ¨¡ç³ŠåŒ–æœºåˆ¶ã€‚

## ğŸ¯ è®¾è®¡ç†å¿µ

### æ ¸å¿ƒåŸåˆ™
1. **æ™ºèƒ½å†³ç­–**ï¼šç”±LLMåˆ¤æ–­æ˜¯å¦éœ€è¦è®°å¿†æ“ä½œï¼Œè€Œä¸æ˜¯æœºæ¢°åœ°å¤„ç†æ¯å¥è¯
2. **æ¸è¿›è¡°å‡**ï¼šè®°å¿†æƒé‡éšæ—¶é—´è‡ªç„¶é™ä½ï¼Œè€Œéçªç„¶é—å¿˜
3. **äº‹ä»¶é©±åŠ¨**ï¼šæ ¹æ®ç”¨æˆ·è¡Œä¸ºï¼ˆå†²çªã€å¼ºåŒ–ã€å›å¿†ï¼‰åŠ¨æ€è°ƒæ•´è®°å¿†
4. **åŒå±‚æ¶æ„**ï¼šçŸ­æœŸä¸Šä¸‹æ–‡ä¿è¯è¿è´¯ï¼Œé•¿æœŸè®°å¿†å®ç°è·¨ä¼šè¯

---

## ğŸ§© è®°å¿†ç®¡ç†ç­–ç•¥

### 1. è®°å¿†å­˜å‚¨ç­–ç•¥

#### é»˜è®¤è¡Œä¸º
- æ¯è½®å¯¹è¯ç»“æŸåï¼Œç”±LLMåˆ¤æ–­æ˜¯å¦æœ‰éœ€è¦å†™å…¥çš„å…³é”®ä¿¡æ¯
- é¿å…é€å¥å­˜å‚¨ï¼Œå‡å°‘å†—ä½™
- ä»…å­˜å‚¨æœ‰ä»·å€¼çš„é•¿æœŸä¿¡æ¯

#### è§¦å‘åœºæ™¯
| åœºæ™¯ç±»å‹ | ç¤ºä¾‹                           | æ“ä½œ               |
| -------- | ------------------------------ | ------------------ |
| ç”¨æˆ·åå¥½ | "æˆ‘å–œæ¬¢å–å’–å•¡"                 | å­˜å‚¨ï¼šç”¨æˆ·åå¥½å’–å•¡ |
| èº«ä»½ä¿¡æ¯ | "æˆ‘ä½åœ¨çº½çº¦"                   | å­˜å‚¨ï¼šå±…ä½åœ°ä¿¡æ¯   |
| é•¿æœŸç›®æ ‡ | "å¸®æˆ‘æ¯å¤©æé†’é”»ç‚¼"             | å­˜å‚¨ï¼šé”»ç‚¼æé†’ä»»åŠ¡ |
| äº‹å®çº æ­£ | "æˆ‘ä¸æ˜¯ä½åœ¨çº½çº¦ï¼Œæˆ‘ä½åœ¨æ´›æ‰çŸ¶" | æ›´æ–°ï¼šå±…ä½åœ°å˜æ›´   |
| æ™®é€šé—²èŠ | "ä½ å¥½"ã€"å¤©æ°”çœŸå¥½"             | å¿½ç•¥ï¼šä¸å­˜å‚¨       |

#### å­˜å‚¨å½¢å¼
```python
{
    "content": "ç”¨æˆ·å–œæ¬¢å–å’–å•¡",
    "timestamp": "2025-11-20T10:30:00",
    "weight": 1.0,
    "level": "full",
    "metadata": {
        "category": "preference",
        "user_id": "user_001"
    }
}
```

---

### 2. è®°å¿†æ›´æ–°ç­–ç•¥

#### é€»è¾‘
ç”±LLMåˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œè€Œä¸æ˜¯ç®€å•è¦†ç›–

#### è§¦å‘åœºæ™¯ä¸å¤„ç†

| äº‹ä»¶ç±»å‹       | åœºæ™¯ç¤ºä¾‹                       | å¤„ç†æ–¹å¼                                                                         |
| -------------- | ------------------------------ | -------------------------------------------------------------------------------- |
| ğŸ”„ **å†²çªäº‹ä»¶** | ç”¨æˆ·ï¼š"æˆ‘ä¸å–å’–å•¡äº†ï¼Œæ”¹å–èŒ¶"   | â€¢ æ—§è®°å¿†æƒé‡é™ä½ï¼ˆ1.0 â†’ 0.3ï¼‰<br>â€¢ è½¬åŒ–ä¸ºæ‘˜è¦æˆ–æ¨¡ç³ŠåŒ–<br>â€¢ å†™å…¥æ–°è®°å¿†ï¼ˆæƒé‡1.0ï¼‰ |
| ğŸ’ª **å¼ºåŒ–äº‹ä»¶** | ç”¨æˆ·ï¼š"æˆ‘çœŸçš„å¾ˆå–œæ¬¢å’–å•¡"       | â€¢ æ—§è®°å¿†æƒé‡æå‡ï¼ˆ1.0 â†’ 1.2ï¼‰<br>â€¢ ä¿æŒæ¸…æ™°åº¦<br>â€¢ å¯é€‰ï¼šæ·»åŠ å¼ºåŒ–æ ‡è®°            |
| ğŸ“ **çº æ­£äº‹ä»¶** | ç”¨æˆ·ï¼š"æˆ‘ä¸æ˜¯ä½çº½çº¦ï¼Œæ˜¯æ´›æ‰çŸ¶" | â€¢ æ—§è®°å¿†æ ‡è®°ä¸º"å·²çº æ­£"<br>â€¢ æƒé‡é™è‡³0.1ï¼ˆä¿ç•™å¯è¿½æº¯ï¼‰<br>â€¢ å†™å…¥æ­£ç¡®ä¿¡æ¯          |
| ğŸ” **å›å¿†äº‹ä»¶** | ç”¨æˆ·ï¼š"è¿˜è®°å¾—æˆ‘ä»¥å‰å–ä»€ä¹ˆå—ï¼Ÿ" | â€¢ æ—§è®°å¿†æƒé‡æ¢å¤ï¼ˆ0.3 â†’ 0.8ï¼‰<br>â€¢ é‡æ–°æ¿€æ´»ç›¸å…³è®°å¿†                              |

#### æ›´æ–°å®ç°ç¤ºä¾‹
```python
# å†²çªäº‹ä»¶å¤„ç†
def handle_conflict(old_memory, new_info):
    old_memory.weight *= 0.3  # é™ä½æƒé‡
    old_memory.level = MemoryLevel.SUMMARY  # è½¬ä¸ºæ‘˜è¦
    
    new_memory = Memory(
        content=new_info,
        weight=1.0,
        level=MemoryLevel.FULL
    )
    return new_memory
```

---

### 3. è®°å¿†æŸ¥è¯¢ç­–ç•¥

#### æŸ¥è¯¢è§¦å‘é€»è¾‘
**ä¸æ˜¯æ¯å¥è¯éƒ½æŸ¥è¯¢**ï¼Œç”±LLMå†³ç­–ï¼š

```python
def should_query_memory(user_message):
    """LLMåˆ†ææ˜¯å¦éœ€è¦æŸ¥è¯¢è®°å¿†"""
    # ç¤ºä¾‹å†³ç­–é€»è¾‘
    if contains_question(user_message):  # åŒ…å«ç–‘é—®è¯
        return True
    if mentions_past(user_message):      # æåŠ"ä»¥å‰"ã€"ä¹‹å‰"
        return True
    if requests_summary(user_message):   # è¯·æ±‚æ€»ç»“
        return True
    return False
```

#### è§¦å‘åœºæ™¯
| åœºæ™¯     | ç¤ºä¾‹               | æŸ¥è¯¢æ“ä½œ           |
| -------- | ------------------ | ------------------ |
| ç›´æ¥æé—® | "æˆ‘å–œæ¬¢ä»€ä¹ˆé¥®æ–™ï¼Ÿ" | æŸ¥è¯¢åå¥½ç±»è®°å¿†     |
| è¯·æ±‚å›é¡¾ | "æˆ‘ä»¥å‰è¯´è¿‡ä»€ä¹ˆï¼Ÿ" | æŸ¥è¯¢æ‰€æœ‰è®°å¿†å¹¶æ’åº |
| ä»»åŠ¡å»¶ç»­ | "ç»§ç»­æ˜¨å¤©çš„è®¡åˆ’"   | æŸ¥è¯¢ä»»åŠ¡ç›¸å…³è®°å¿†   |
| æ™®é€šé™ˆè¿° | "æˆ‘ä»Šå¤©å¾ˆå¼€å¿ƒ"     | ä¸æŸ¥è¯¢ï¼ˆå¯èƒ½å­˜å‚¨ï¼‰ |

#### æŸ¥è¯¢ä¼˜åŒ–
```python
def search_memory(query, user_id):
    # 1. ä¼˜å…ˆæ£€ç´¢é«˜æƒé‡è®°å¿†ï¼ˆè¿‘æœŸ/é‡è¦ï¼‰
    recent = search_by_weight(query, threshold=0.7)
    
    # 2. è‹¥æ— ç»“æœï¼Œæ£€ç´¢ä¸­ç­‰æƒé‡ï¼ˆæ‘˜è¦è®°å¿†ï¼‰
    if not recent:
        summary = search_by_weight(query, threshold=0.3)
    
    # 3. è‹¥ä»æ— ç»“æœï¼Œæ£€ç´¢ä½æƒé‡ï¼ˆæ ‡ç­¾è®°å¿†ï¼‰
    if not summary:
        tags = search_by_weight(query, threshold=0.0)
    
    return merge_results([recent, summary, tags])
```

---

## â±ï¸ æ—¶é—´è¡°å‡æœºåˆ¶

### è¡°å‡å…¬å¼
```
w(t) = wâ‚€ / (1 + Î± * t)

å…¶ä¸­ï¼š
- w(t): tæ—¶åˆ»çš„æƒé‡
- wâ‚€: åˆå§‹æƒé‡
- Î±: è¡°å‡ç³»æ•°ï¼ˆæ¨è0.01ï¼‰
- t: ç»è¿‡çš„å¤©æ•°
```

### è¡°å‡ç¤ºä¾‹
| åˆå§‹æƒé‡ | ç»è¿‡å¤©æ•° | Î±å€¼  | è®¡ç®—             | æœ€ç»ˆæƒé‡ |
| -------- | -------- | ---- | ---------------- | -------- |
| 1.0      | 0        | 0.01 | 1.0/(1+0.01Ã—0)   | 1.00     |
| 1.0      | 30       | 0.01 | 1.0/(1+0.01Ã—30)  | 0.77     |
| 1.0      | 100      | 0.01 | 1.0/(1+0.01Ã—100) | 0.50     |
| 1.0      | 200      | 0.01 | 1.0/(1+0.01Ã—200) | 0.33     |
| 1.0      | 500      | 0.01 | 1.0/(1+0.01Ã—500) | 0.17     |

### Pythonå®ç°
```python
class MemoryDecayCalculator:
    def __init__(self, alpha=0.01):
        self.alpha = alpha
    
    def calculate_weight(self, initial_weight, days_passed):
        return initial_weight / (1 + self.alpha * days_passed)
    
    def get_memory_level(self, weight):
        if weight >= 0.7:
            return MemoryLevel.FULL      # å®Œæ•´è®°å¿†
        elif weight >= 0.3:
            return MemoryLevel.SUMMARY   # æ‘˜è¦è®°å¿†
        else:
            return MemoryLevel.TAG       # æ ‡ç­¾è®°å¿†
```

---

## ğŸšï¸ æ¨¡ç³ŠåŒ–å±‚æ¬¡ç­–ç•¥

### ä¸‰å±‚è®°å¿†æ¸…æ™°åº¦
| å±‚æ¬¡           | æƒé‡èŒƒå›´  | å‘ˆç°å½¢å¼ | ç¤ºä¾‹                 |
| -------------- | --------- | -------- | -------------------- |
| ğŸ”† **å®Œæ•´è®°å¿†** | â‰¥ 0.7     | åŸå§‹å†…å®¹ | "ç”¨æˆ·å–œæ¬¢å–ç¾å¼å’–å•¡" |
| ğŸŒ¤ï¸ **æ‘˜è¦è®°å¿†** | 0.3 ~ 0.7 | æ¦‚æ‹¬å†…å®¹ | "ç”¨æˆ·åå¥½å’–å•¡ç±»é¥®å“" |
| ğŸŒ‘ **æ ‡ç­¾è®°å¿†** | < 0.3     | ç®€åŒ–æ ‡ç­¾ | "ç”¨æˆ·å–œæ¬¢é¥®å“"       |

### æ¨¡ç³ŠåŒ–è½¬æ¢ç¤ºä¾‹
```python
# åŸå§‹è®°å¿†ï¼ˆ100å¤©å‰ï¼‰
original = "ç”¨æˆ·å–œæ¬¢å–ç¾å¼å’–å•¡ï¼Œä¸åŠ ç³–ä¸åŠ å¥¶"
weight = 1.0 / (1 + 0.01 * 100) = 0.50

# è½¬ä¸ºæ‘˜è¦è®°å¿†
summary = summarize_memory(original)
# ç»“æœ: "ç”¨æˆ·åå¥½é»‘å’–å•¡"

# åŸå§‹è®°å¿†ï¼ˆ300å¤©å‰ï¼‰
weight = 1.0 / (1 + 0.01 * 300) = 0.25

# è½¬ä¸ºæ ‡ç­¾è®°å¿†
tag = extract_tag(original)
# ç»“æœ: "é¥®å“åå¥½"
```

### ä¸Šä¸‹æ–‡æ ¼å¼åŒ–
```python
def format_memory_for_context(memories):
    context = []
    
    for mem in memories:
        if mem.weight >= 0.7:
            # å®Œæ•´è®°å¿†ï¼šæ¸…æ™°å‘ˆç°
            context.append(f"âœ“ {mem.content}")
        elif mem.weight >= 0.3:
            # æ‘˜è¦è®°å¿†ï¼šæ ‡æ³¨æ—¶é—´æ¨¡ç³Š
            context.append(f"~ {mem.content}ï¼ˆè¾ƒæ—©å‰çš„å°è±¡ï¼‰")
        else:
            # æ ‡ç­¾è®°å¿†ï¼šæ ‡æ³¨éå¸¸æ¨¡ç³Š
            context.append(f"Â· {mem.content}ï¼ˆä¹…è¿œçš„æ¨¡ç³Šå°è±¡ï¼‰")
    
    return "\n".join(context)
```

---

## ğŸ—ï¸ åŒå±‚è®°å¿†æ¶æ„

### æ¶æ„å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ç”¨æˆ·è¾“å…¥                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  LLM å†³ç­–å¼•æ“  â”‚
         â”‚  åˆ¤æ–­è®°å¿†æ“ä½œ  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  çŸ­æœŸä¸Šä¸‹æ–‡   â”‚  â”‚  é•¿æœŸè®°å¿†    â”‚
  â”‚ (å½“å‰ä¼šè¯)   â”‚  â”‚  (Mem0)      â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                  â”‚
         â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚    â”‚ â€¢ å­˜å‚¨       â”‚
         â”‚    â”‚ â€¢ æŸ¥è¯¢       â”‚
         â”‚    â”‚ â€¢ æ›´æ–°       â”‚
         â”‚    â”‚ â€¢ è¡°å‡è®¡ç®—   â”‚
         â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
         â”‚                  â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  ç”Ÿæˆå›å¤      â”‚
         â”‚ (çŸ­æœŸ+é•¿æœŸ)    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### çŸ­æœŸä¸Šä¸‹æ–‡ï¼ˆShort-term Contextï¼‰
- **ç”Ÿå‘½å‘¨æœŸ**: ä»…é™å½“å‰ä¼šè¯
- **å†…å®¹**: æœ€è¿‘5-10è½®å¯¹è¯
- **ä½œç”¨**: ä¿è¯å¯¹è¯è¿è´¯æ€§
- **å­˜å‚¨**: å†…å­˜ï¼ˆä¸æŒä¹…åŒ–ï¼‰

```python
short_term_context = {
    "user_001": [
        {"role": "user", "content": "ä½ å¥½"},
        {"role": "assistant", "content": "ä½ å¥½ï¼æœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„ï¼Ÿ"},
        {"role": "user", "content": "æˆ‘å–œæ¬¢å’–å•¡"},
        # ... æœ€è¿‘å‡ è½®å¯¹è¯
    ]
}
```

### é•¿æœŸè®°å¿†ï¼ˆLong-term Memoryï¼‰
- **ç”Ÿå‘½å‘¨æœŸ**: è·¨ä¼šè¯æŒä¹…åŒ–
- **å†…å®¹**: ç”¨æˆ·åå¥½ã€èº«ä»½ä¿¡æ¯ã€å†å²äº‹ä»¶
- **ä½œç”¨**: æä¾›ä¸ªæ€§åŒ–æœåŠ¡
- **å­˜å‚¨**: Mem0å‘é‡æ•°æ®åº“ï¼ˆQdrantï¼‰

```python
long_term_memory = [
    {
        "content": "ç”¨æˆ·å–œæ¬¢å–å’–å•¡",
        "weight": 0.85,
        "timestamp": "2025-11-01T10:00:00"
    },
    {
        "content": "ç”¨æˆ·æ˜¯è½¯ä»¶å·¥ç¨‹å¸ˆ",
        "weight": 1.0,
        "timestamp": "2025-11-20T09:30:00"
    }
]
```

### ååŒå·¥ä½œæµç¨‹
```python
def process_conversation(user_id, message):
    # 1. æ·»åŠ åˆ°çŸ­æœŸä¸Šä¸‹æ–‡
    short_term_context[user_id].append({
        "role": "user",
        "content": message
    })
    
    # 2. LLMå†³ç­–è®°å¿†æ“ä½œ
    action = decide_memory_action(message)
    
    # 3. æ‰§è¡Œé•¿æœŸè®°å¿†æ“ä½œ
    if action == "QUERY":
        long_term = search_memory(user_id, message)
    elif action == "STORE":
        add_memory(user_id, message)
    
    # 4. ç”Ÿæˆå›å¤ï¼ˆçŸ­æœŸ+é•¿æœŸï¼‰
    response = generate_response(
        short_term=short_term_context[user_id][-5:],
        long_term=long_term
    )
    
    return response
```

---

## ğŸ“Š å®Œæ•´å·¥ä½œæµç¤ºä¾‹

### åœºæ™¯ï¼šç”¨æˆ·åå¥½å˜æ›´

#### åˆå§‹çŠ¶æ€
```json
{
    "memory": "ç”¨æˆ·å–œæ¬¢å–å’–å•¡",
    "timestamp": "2025-09-01T10:00:00",
    "weight": 1.0,
    "level": "full"
}
```

#### æ—¶é—´æµé€ï¼ˆ100å¤©åï¼‰
```python
# è®¡ç®—è¡°å‡
days_passed = 100
new_weight = 1.0 / (1 + 0.01 * 100) = 0.50

# è½¬ä¸ºæ‘˜è¦è®°å¿†
{
    "memory": "ç”¨æˆ·åå¥½å’–å•¡ç±»é¥®å“",
    "timestamp": "2025-09-01T10:00:00",
    "weight": 0.50,
    "level": "summary"
}
```

#### ç”¨æˆ·å˜æ›´åå¥½ï¼ˆç¬¬110å¤©ï¼‰
```
ç”¨æˆ·è¾“å…¥: "æˆ‘ç°åœ¨æ”¹å–èŒ¶äº†ï¼Œä¸å–å’–å•¡äº†"
```

**LLMå†³ç­–**ï¼š
```json
{
    "action": "UPDATE",
    "reason": "ç”¨æˆ·åå¥½å˜æ›´",
    "key_info": "ä»å’–å•¡æ”¹ä¸ºèŒ¶"
}
```

**ç³»ç»Ÿå¤„ç†**ï¼š
```python
# 1. æ—§è®°å¿†æƒé‡é™ä½
old_memory.weight = 0.50 * 0.3 = 0.15  # é™è‡³æ ‡ç­¾çº§åˆ«
old_memory.level = "tag"
old_memory.content = "é¥®å“åå¥½å†å²"

# 2. å†™å…¥æ–°è®°å¿†
new_memory = {
    "memory": "ç”¨æˆ·å–œæ¬¢å–èŒ¶ï¼Œä¸å–å’–å•¡",
    "timestamp": "2025-12-20T14:00:00",
    "weight": 1.0,
    "level": "full"
}
```

#### ç”¨æˆ·æŸ¥è¯¢ï¼ˆç¬¬120å¤©ï¼‰
```
ç”¨æˆ·è¾“å…¥: "æˆ‘å–œæ¬¢å–ä»€ä¹ˆï¼Ÿ"
```

**ç³»ç»Ÿå“åº”**ï¼š
```python
# æŸ¥è¯¢ç»“æœï¼ˆæŒ‰æƒé‡æ’åºï¼‰
memories = [
    {
        "memory": "ç”¨æˆ·å–œæ¬¢å–èŒ¶ï¼Œä¸å–å’–å•¡",
        "weight": 0.91,  # 10å¤©è¡°å‡å
        "level": "full"
    },
    {
        "memory": "é¥®å“åå¥½å†å²",
        "weight": 0.15,
        "level": "tag"
    }
]

# æ ¼å¼åŒ–ä¸Šä¸‹æ–‡
context = """
âœ“ ç”¨æˆ·å–œæ¬¢å–èŒ¶ï¼Œä¸å–å’–å•¡
Â· é¥®å“åå¥½å†å²ï¼ˆä¹…è¿œçš„æ¨¡ç³Šå°è±¡ï¼‰
"""

# åŠ©ç†å›ç­”
response = "ä½ ç°åœ¨å–œæ¬¢å–èŒ¶ï¼Œä»¥å‰ä¹Ÿæåˆ°è¿‡å’–å•¡ç›¸å…³çš„åå¥½ã€‚"
```

---

## ğŸ› ï¸ å®ç°å»ºè®®

### ä¸Mem0çš„é›†æˆ

#### å­˜å‚¨æ—¶é™„åŠ å…ƒæ•°æ®
```python
def add_memory_with_metadata(user_id, content):
    response = requests.post(
        f"{MEM0_URL}/memories",
        json={
            "messages": [{"role": "user", "content": content}],
            "user_id": user_id,
            "metadata": {
                "timestamp": datetime.now().isoformat(),
                "weight": 1.0,
                "level": "full",
                "category": "preference"  # å¯é€‰åˆ†ç±»
            }
        }
    )
    return response.json()
```

#### æŸ¥è¯¢æ—¶åº”ç”¨è¡°å‡
```python
def search_memory_with_decay(user_id, query):
    # 1. ä»Mem0è·å–è®°å¿†
    memories = mem0_search(user_id, query)
    
    # 2. åº”ç”¨æ—¶é—´è¡°å‡
    now = datetime.now()
    for mem in memories:
        timestamp = datetime.fromisoformat(mem["metadata"]["timestamp"])
        days_passed = (now - timestamp).total_seconds() / 86400
        
        initial_weight = mem["metadata"]["weight"]
        current_weight = initial_weight / (1 + 0.01 * days_passed)
        
        mem["current_weight"] = current_weight
        mem["memory_level"] = get_memory_level(current_weight)
    
    # 3. æŒ‰å½“å‰æƒé‡æ’åº
    memories.sort(key=lambda m: m["current_weight"], reverse=True)
    
    return memories
```

#### å®šæœŸç»´æŠ¤ä»»åŠ¡
```python
# æ¯å¤©å‡Œæ™¨æ‰§è¡Œ
def maintain_memories():
    users = get_all_users()
    
    for user_id in users:
        memories = list_all_memories(user_id)
        
        for mem in memories:
            # è®¡ç®—å½“å‰æƒé‡
            current_weight = calculate_weight(mem)
            
            # è½¬æ¢è®°å¿†å±‚æ¬¡
            if current_weight < 0.7 and mem["level"] == "full":
                summarize_memory(mem)  # è½¬ä¸ºæ‘˜è¦
            
            elif current_weight < 0.3 and mem["level"] == "summary":
                tagify_memory(mem)  # è½¬ä¸ºæ ‡ç­¾
```

---

## ğŸ“ˆ ä¼˜åŒ–æ–¹å‘

### 1. æ™ºèƒ½åˆ†ç±»
```python
# æ ¹æ®å†…å®¹è‡ªåŠ¨åˆ†ç±»
categories = {
    "preference": ["å–œæ¬¢", "åå¥½", "ä¹ æƒ¯"],
    "identity": ["æ˜¯", "èŒä¸š", "åå­—"],
    "task": ["æé†’", "å¸®æˆ‘", "ä»»åŠ¡"],
    "fact": ["ä½åœ¨", "æ¥è‡ª", "æ—¶é—´"]
}
```

### 2. ç›¸å…³æ€§å¼ºåŒ–
```python
# ç›¸å…³è®°å¿†ä¸€èµ·å¼ºåŒ–
if user_mentions("å’–å•¡"):
    strengthen_related_memories(["å’–å•¡", "é¥®å“", "æ‹¿é“"])
```

### 3. å¤šæ¨¡æ€è®°å¿†
```python
# æ”¯æŒä¸åŒç±»å‹è®°å¿†
memory_types = {
    "text": "ç”¨æˆ·å–œæ¬¢å’–å•¡",
    "image": "ç”¨æˆ·æœ€å–œæ¬¢çš„å’–å•¡åº—ç…§ç‰‡",
    "audio": "ç”¨æˆ·è¯­éŸ³å¤‡å¿˜å½•"
}
```

### 4. è®°å¿†å›¾è°±
```python
# æ„å»ºè®°å¿†å…³ç³»ç½‘ç»œ
memory_graph = {
    "å’–å•¡": ["é¥®å“", "å’–å•¡å› ", "æ—©é¤"],
    "ç”¨æˆ·": ["è½¯ä»¶å·¥ç¨‹å¸ˆ", "Python", "åŒ—äº¬"]
}
```

---

## âœ… æ€»ç»“

| ç‰¹æ€§       | ä¼ ç»Ÿæ–¹å¼      | æ™ºèƒ½è®°å¿†ç®¡ç†           |
| ---------- | ------------- | ---------------------- |
| å­˜å‚¨è§¦å‘   | æ¯å¥è¯å­˜å‚¨    | LLMå†³ç­–å­˜å‚¨            |
| è®°å¿†æ›´æ–°   | ç›´æ¥è¦†ç›–      | äº‹ä»¶é©±åŠ¨æ›´æ–°           |
| è®°å¿†æŸ¥è¯¢   | æ¯æ¬¡éƒ½æŸ¥      | æŒ‰éœ€æŸ¥è¯¢               |
| æ—¶é—´å¤„ç†   | ç¡¬åˆ é™¤        | æ¸è¿›è¡°å‡               |
| è®°å¿†æ¸…æ™°åº¦ | äºŒå…ƒï¼ˆæœ‰/æ— ï¼‰ | ä¸‰å±‚ï¼ˆå®Œæ•´/æ‘˜è¦/æ ‡ç­¾ï¼‰ |
| ä¸Šä¸‹æ–‡ç®¡ç† | å•ä¸€          | åŒå±‚ï¼ˆçŸ­æœŸ+é•¿æœŸï¼‰      |

### æ ¸å¿ƒä¼˜åŠ¿
1. âœ… **ä¸é—å¿˜**ï¼šæ‰€æœ‰è®°å¿†ä¿ç•™ï¼Œåªæ˜¯é€æ¸æ¨¡ç³Š
2. âœ… **æ¸è¿›è¡°å‡**ï¼šé¿å…ç¡¬åˆ†æ®µï¼Œè‡ªç„¶æ·¡åŒ–
3. âœ… **äº‹ä»¶é©±åŠ¨**ï¼šç”¨æˆ·è¡Œä¸ºå†³å®šè®°å¿†å¼ºå¼±
4. âœ… **æ™ºèƒ½å†³ç­–**ï¼šå‡å°‘æ— æ•ˆæ“ä½œï¼Œæå‡æ•ˆç‡
5. âœ… **å¯è¿½æº¯**ï¼šå†å²è®°å¿†å¯å›æº¯ï¼Œä¿è¯è¿ç»­æ€§

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Mem0 å®˜æ–¹æ–‡æ¡£](https://docs.mem0.ai/)
- [äººç±»è®°å¿†æ¨¡å‹ç ”ç©¶](https://en.wikipedia.org/wiki/Forgetting_curve)
- [æ—¶é—´è¡°å‡ç®—æ³•](https://en.wikipedia.org/wiki/Decay_theory)
